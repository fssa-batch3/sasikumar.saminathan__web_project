<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    <link rel="stylesheet" href="../../../assets/css/map.css">
<script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw==" crossorigin="anonymous" referrerpolicy="no-referrer" />
<script src="https://cdn.jsdelivr.net/npm/geolib/dist/geolib.min.js"></script>

</head>

<body>
    <header>
        <!-- div:logo  contain:logo img and name -->
        <div class="logo">
            <img src="../../../assets/icon/shopping-bag.png" alt="shopping-bag" width="30px" height="30px">
            <h5 class="logo-name"><b>Shopnow</b></h5>
        </div>
    
        <!-- search bar -->
    
    
        <!-- header nav links -->
        <ul class="top-list">
            <a href="pages/buyer/main flow/mobile_list.html"><li><button class="login" id="mobiles"><b>Mobiles</b></button></li></a>
            <li><button class="login" id="login"><b>My account</b></button>
            </li>
            <li id="seller"><a aria-label="seller" href="pages/Seller/Seller.html">
                    <p class="seller">Seller</p>
                </a></li>
            <li><a id="cart" aria-label="cart"><i id="cart_icon" class="home-icon fa fa-shopping-cart"
                        aria-hidden="true"></i></a></li>
            <li><a aria-label="pincode"><i id="order_icon"
                        class="home-icon fa-solid fa-location-dot"></i></a></li>
                        <li id="order_hide"><a id="order"><i class="home-icon fa-solid fa-bag-shopping"></i></a></li>
    
        </ul>
        <i id="bar" class="fa-solid fa-bars"></i>
    </header>
    <div id="my-map"></div>
</body>
<script>
    let profile = JSON.parse(localStorage.getItem("profile"))
    let shop_arr = JSON.parse(localStorage.getItem("shop"))
    console.log(shop_arr);
// Leaflet has native support for raster maps, So you can create a map with a few commands only!
// The Leaflet map Object
var map = L.map('my-map').setView([profile["lat"],profile["lon"]], 15);
// The API Key provided is restricted to JSFiddle website
// Get your own API Key on https://myprojects.geoapify.com
var myAPIKey = "002d636de5c4489a883a653e0a4b9268";
// Retina displays require different mat tiles quality
var isRetina = L.Browser.retina;
var baseUrl = "https://maps.geoapify.com/v1/tile/osm-bright/{z}/{x}/{y}.png?apiKey=002d636de5c4489a883a653e0a4b9268";
var retinaUrl = "https://maps.geoapify.com/v1/tile/osm-bright/{z}/{x}/{y}@2x.png?apiKey=002d636de5c4489a883a653e0a4b9268";
// Add map tiles layer. Set 20 as the maximal zoom and provide map data attribution.
L.tileLayer(isRetina ? retinaUrl : baseUrl, {
    attribution: 'Powered by <a href="https://www.geoapify.com/" target="_blank">Geoapify</a> | <a href="https://openmaptiles.org/" rel="nofollow" target="_blank">© OpenMapTiles</a> <a href="https://www.openstreetmap.org/copyright" rel="nofollow" target="_blank">© OpenStreetMap</a> contributors',
    apiKey: myAPIKey,
    maxZoom: 20,
    id: 'osm-bright',
}).addTo(map);
const markerIcon = L.icon({
  iconUrl: `https://api.geoapify.com/v1/icon?size=xx-large&type=awesome&color=%233e9cfe&icon=paw&apiKey=${myAPIKey}`,
  iconSize: [31, 46], // size of the icon
  iconAnchor: [15.5, 42], // point of the icon which will correspond to marker's location
  popupAnchor: [0, -45] // point from which the popup should open relative to the iconAnchor
});
// const zooMarker = L.marker([13.0827, 80.2707], {
//   icon: markerIcon
// }).addTo(map);
for (let i = 0; i < shop_arr.length; i++) {

 let lat1 = profile["lat"]
 let lon1 = profile["lon"]
 let lat2 = shop_arr[i]["latitude"]
 let lon2 = shop_arr[i]["longitude"]
//  console.log(lat1,lon1,lat2,lon2);

const distanceInMeters = geolib.getDistance(
  {latitude: lat1, longitude: lon1},
  {latitude: lat2, longitude: lon2}
);

const distanceInKilometers = distanceInMeters / 1000;
console.log(distanceInKilometers);

if (distanceInKilometers < 3) {
    const zooMarkerPopup = L.popup().setContent(`<a href="shop-detail.html?id=${shop_arr[i]["id"]}">${shop_arr[i]["name"]}</a>`);
    const zooMarker = L.marker([shop_arr[i]["latitude"],shop_arr[i]["longitude"]], {
  icon: markerIcon
}).bindPopup(zooMarkerPopup).addTo(map);
}
}
</script>