<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shopnow</title>
    <link rel="icon" type = "image/x-icon" href="../../assets/icon/shopping-bag.png">
    <link rel="stylesheet" href="../../assets/css/mobile_create.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw==" crossorigin="anonymous" referrerpolicy="no-referrer" />

</head>
<body>
    <header> 
        <div class="logo">
        <img src="../../assets/icon/shopping-bag.png" alt="shopping-bag" width="40px" height="40px">
        <h5 class="logo-name"><b>Shopnow</b></h5>
    </div>
    <i class="fa fa-search" aria-hidden="true"></i>
    <ul class="top-list">
        <a href="../sign-in/login.html"><button class="login"><b>Login</b></button></a>
       <a href="../buyer/cart.html"><i class="home-icon fa fa-shopping-cart" aria-hidden="true"></i></a>
       <a href="../buyer/side flow/pincode.html"> <i class="home-icon fa-solid fa-location-dot"></i></a>
    </ul>
</header>

<main>
    <div id="lines"><div id="line"></div><p id="head">Add products to your shop</p><div id="line" class="line2"></div></div>
<div class="model"><p>Model name :</p><input id="search" type="search"><button class="button-25">Add product</button></div>
<div class="product_list"></div>
</div>
</main>
<form id="forms">
    <div class="main_container">
        <i class="fa-solid fa-xmark"></i>
        <div><p>Product Name</p><input type="text" class="inputs" id="pr_name"></div>
      <div><p>Product price</p><input type="text" class="inputs" id="pr_price"></div>
      <div><p>Ram</p><input type="number" class="inputs" id="pr_ram"></div>
      <div><p>Rom</p><input type="number" class="inputs" id="pr_rom"></div>
    <div class="product-img">
        <div><p>Upload image urls</p><input type="url" class="inputs" id="pr_img_1"></div>
        <div><input type="url" class="inputs" id="pr_img_2"></div>
        <div><input type="url" class="inputs" id="pr_img_3"></div>
        <div><input type="url" class="inputs" id="pr_img_4"></div>
    </div>
      <div><p>Highlights</p><input type="text" id="high"></div>
      <button type="button" class="pr_btn" id="sub">SUBMIT</button>
      <button type="button" class="pr_btn" id="edit">Update</button>
    </div>
      
 </form>
<script>

    //get the search input element
    const search = document.getElementById("search")
    const btn = document.querySelector(".button-25")
    

    //event for search the product
    btn.addEventListener("click",function(){
         
        const searchvalue = search.value.trim().toLowerCase()
        const url = `https://api.device-specs.io/api/fuzzy-search/search?query=${searchvalue}`
        const apiToken = 'dbb6aa9f19eb449abe6819ff6b506aabc51c5665e80cc8e81b63fcf20ea1d54e399d474c244538e51be5956ce632640be1e1d641e898332dfb73fe90a00d2aa6834f4c7f3cf88c54c5b9c9bec9d10c6f965711f75f0fe31b454d63c43579156987c0831d14d868ce5a40af46896fdbf2c8f026a86a4c99f347b090319883b2d7';

            fetch(url, {
            headers: {
                'Authorization': `Bearer ${apiToken}`
            }
            })
            .then(response => response.json())
            .then(
                response => {
                    let mobile_id;
                    
                    
                    for (let i = 0; i < response.smartphones.length; i++) {
                        if (response.smartphones[i]["images"] === null) {
                            continue;
                        }
                    else{
                        let arr_length = response.smartphones[i]["images"].length
                                    console.log(arr_length);     
                        
                        if (arr_length == 4) {
                            
                        mobile_id = response.smartphones[i]
                        break;
                        }
                        
                        else{
                            mobile_id = response.smartphones[i]
                        }
                        
                    }
                    
                     
                        
                    }
                    localStorage.setItem("mobile",JSON.stringify(mobile_id))
                    console.log(mobile_id);    
                    
        //getting values for push
        const pr_name =document.getElementById("pr_name")
        const ram =document.getElementById("pr_ram")
        const rom =document.getElementById("pr_rom")
        const price = document.getElementById("pr_price")
        const img_1 = document.getElementById("pr_img_1")
        const img_2 = document.getElementById("pr_img_2")
        const img_3 = document.getElementById("pr_img_3")
        const img_4 = document.getElementById("pr_img_4")
        const highlights = document.getElementById("high")
        const main_container = document.getElementById("forms")


        pr_name.value = mobile_id["name"]
        highlights.value = mobile_id["info"]
        img_1.value = mobile_id["images"][0]["url"]
        img_2.value = mobile_id["images"][1]["url"]
        img_3.value = mobile_id["images"][2]["url"]
        img_4.value = mobile_id["images"][3]["url"]
                
                }
            )
            .catch(error => {
            console.log(error);
            });
            

        
        const main_container = document.getElementById("forms")
        main_container.style.display = "block"


                })

        //getting values for push
        const pr_name =document.getElementById("pr_name")
        const ram =document.getElementById("pr_ram")
        const rom =document.getElementById("pr_rom")
        const price = document.getElementById("pr_price")
        const img_1 = document.getElementById("pr_img_1")
        const img_2 = document.getElementById("pr_img_2")
        const img_3 = document.getElementById("pr_img_3")
        const img_4 = document.getElementById("pr_img_4")
        const highlights = document.getElementById("high")
        const main_container = document.getElementById("forms")


        //get element from submit btn
        const submit_btn = document.getElementById("sub")
        const edit_btn = document.getElementById("edit")

    submit_btn.addEventListener("click",function(e){
                    
     //genreate unique id
     let uid = Math.floor(Math.random() * 100)
     let profile = JSON.parse(localStorage.getItem("profile"))
    e.preventDefault();
    
    let product_array = new Array();

    product_array = JSON.parse(localStorage.getItem("products")) ? JSON.parse(localStorage.getItem("products")) : []

    product_array.push({
        "seller_id" : profile["seller_id"],
        "shop_id" : profile["shop_id"],
        "user_id" : uid,
        "product_name" : pr_name.value,
        "product_price" : "â‚¹ " + price.value,
        "product_ram" : ram.value,
        "product_rom" : rom.value,
        "product_img_1" : img_1.value,
        "product_img_2" : img_2.value,
        "product_img_3" : img_3.value,
        "product_img_4" : img_4.value,
        "highlights" : highlights.value,
        "status" : true
    })

  


    localStorage.setItem("products",JSON.stringify(product_array));

    //close the container after submit
    main_container.style.display = "none"
    
})

const x_mark = document.querySelector(".fa-xmark")
x_mark.addEventListener("click",function () {
    main_container.style.display = "none"    
}) 

mobData();
function mobData(params) {
const pr_array = JSON.parse(localStorage.getItem("products"))
for (let j=0; j< pr_array.length; j++) //loop for creating 12 product cards
{
    //div 1 class name: pack
    const div_2 = document.createElement("div");
    div_2.setAttribute("class", "mob")


    //product img
    const img = document.createElement("img");
    img.setAttribute("src", pr_array[j]["product_img_1"])
    img.setAttribute("alt", "redmi_note_11")
    img.setAttribute("width", "150px")
    img.setAttribute("height", "200px")
    div_2.append(img)


    //product name
    const h4 = document.createElement("h4");
    h4.setAttribute("class", "detail-1")
    h4.innerHTML = pr_array[j]["product_name"]
    div_2.append(h4)

    
    const div_3 = document.createElement("div");
    div_3.setAttribute("class", "rate")
    div_2.append(div_3)

    const edit = document.createElement("button")
    edit.setAttribute("class","edit_btn button-38")
    edit.setAttribute("data-keyword",pr_array[j]["user_id"])
    edit.innerText = "Edit"
    div_3.append(edit)

    const delete_btn = document.createElement("button")
    delete_btn.setAttribute("class","delete_btn button-38")
    delete_btn.innerText = "Disable"
    div_3.append(delete_btn)

    if (pr_array[j]["status"] === false) {
    
        img.style.opacity = "50%"
        h4.style.opacity = "50%"
        edit.style.opacity = "50%"
        delete_btn.innerText = "Enable"
        div_3.style.opacity = "100%"
        
    }

   
    let list_div = document.querySelector(".product_list")
    list_div.append(div_2)

    edit.addEventListener("click",function(){
        // let product_id = edit.dataset.keyword
         
        // pr_array.find(function(obj){
        //     if (product_id = obj["user_id"]+"") {
                main_container.style.display = "block"

            //set the value in existing inputs
            const p_name = pr_name.value = pr_array[j]["product_name"]
            ram.value = pr_array[j]["product_ram"]
            rom.value = pr_array[j]["product_rom"]
            price.value = pr_array[j]["product_price"]
            img_1.value = pr_array[j]["product_img_1"]
            img_2.value = pr_array[j]["product_img_2"]
            img_3.value = pr_array[j]["product_img_3"]
            img_4.value = pr_array[j]["product_img_4"]
            highlights.value = pr_array[j]["highlights"]
            pr_name.setAttribute("data-keyword",pr_array[j]["user_id"])


            // }
        // })
        submit_btn.style.display = "none"
        edit_btn.style.display = "block"

        
        

       })

       const pro_array = JSON.parse(localStorage.getItem("products"))
       //for update mobile
        edit_btn.addEventListener("click",function(){
            

            //get the id from element
           let product_id = pr_name.dataset.keyword

            pro_array.find(function (e) {
                if (product_id === e['user_id']+"") {
            e["product_name"] = pr_name.value
            e["product_ram"] = ram.value
            e["product_rom"] = rom.value
            e["product_price"] = price.value
            e["product_img_1"] = img_1.value
            e["product_img_2"] = img_2.value
            e["product_img_3"] = img_3.value
            e["product_img_4"] = img_4.value
            e["highlights"] = highlights.value

            localStorage.setItem("products",JSON.stringify(pro_array))

                }
            })
            main_container.style.display = "none"
            //this condition for removing containers for showing updated containers
            list_div.innerHTML = ""
            mobData();
        })

        //for disable the mobile
        delete_btn.addEventListener("click",function(){
            //get the id from element
           let product_id = edit.dataset.keyword

        if (delete_btn.innerText === "Enable") {
            pro_array.find(function(obj){
            if (product_id === obj["user_id"]+"") {
                obj["status"] = true

                localStorage.setItem("products",JSON.stringify(pro_array))
            }
        })
        }
        else{
            pro_array.find(function(obj){
            if (product_id === obj["user_id"]+"") {
                obj["status"] = false
                localStorage.setItem("products",JSON.stringify(pro_array))
            }
        })
        }
        //this condition for removing containers for showing updated containers
        list_div.innerHTML = ""
        mobData();

    })


       }
    }

      
       




</script>
    
</body>
</html>